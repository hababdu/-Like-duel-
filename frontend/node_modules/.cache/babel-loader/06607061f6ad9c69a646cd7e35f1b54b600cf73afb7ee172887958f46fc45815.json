{"ast":null,"code":"// src/utils/gameWebSocket.js\nexport class GameWebSocket {\n  constructor(url, handlers) {\n    this.url = url;\n    this.handlers = handlers;\n    this.socket = null;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 3000;\n    this.messageQueue = [];\n    this.isConnected = false;\n  }\n  connect() {\n    return new Promise((resolve, reject) => {\n      try {\n        this.socket = new WebSocket(this.url);\n        this.socket.onopen = () => {\n          console.log('WebSocket connected');\n          this.isConnected = true;\n          this.reconnectAttempts = 0;\n          this.flushMessageQueue();\n          if (this.handlers.onOpen) {\n            this.handlers.onOpen();\n          }\n          resolve();\n        };\n        this.socket.onmessage = event => {\n          try {\n            const data = JSON.parse(event.data);\n            this.handleMessage(data);\n          } catch (error) {\n            console.error('Message parse error:', error);\n          }\n        };\n        this.socket.onclose = event => {\n          console.log('WebSocket disconnected:', event.code, event.reason);\n          this.isConnected = false;\n          if (this.handlers.onClose) {\n            this.handlers.onClose(event);\n          }\n          this.attemptReconnect();\n        };\n        this.socket.onerror = error => {\n          console.error('WebSocket error:', error);\n          this.isConnected = false;\n          if (this.handlers.onError) {\n            this.handlers.onError(error);\n          }\n        };\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  handleMessage(data) {\n    console.log('Received:', data);\n\n    // Global message handlers\n    switch (data.type) {\n      case 'authenticated':\n        localStorage.setItem('sessionId', data.sessionId);\n        break;\n      case 'error':\n        console.error('Server error:', data);\n        break;\n    }\n\n    // Custom handler\n    if (this.handlers.onMessage) {\n      this.handlers.onMessage(data);\n    }\n  }\n  send(data) {\n    if (!this.isConnected || !this.socket) {\n      this.messageQueue.push(data);\n      return false;\n    }\n    try {\n      const jsonData = JSON.stringify(data);\n      this.socket.send(jsonData);\n      return true;\n    } catch (error) {\n      console.error('Send error:', error);\n      this.messageQueue.push(data);\n      return false;\n    }\n  }\n  flushMessageQueue() {\n    while (this.messageQueue.length > 0) {\n      const message = this.messageQueue.shift();\n      this.send(message);\n    }\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error('Max reconnection attempts reached');\n      return;\n    }\n    this.reconnectAttempts++;\n    console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\n    setTimeout(() => {\n      this.connect().catch(error => {\n        console.error('Reconnect failed:', error);\n      });\n    }, this.reconnectDelay * this.reconnectAttempts);\n  }\n  close() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n    this.isConnected = false;\n  }\n}\n\n// Singleton instance\nlet gameSocketInstance = null;\nexport const connectToGameServer = (userData, handlers) => {\n  if (gameSocketInstance) {\n    gameSocketInstance.close();\n  }\n  const wsUrl = process.env.REACT_APP_WS_URL || 'ws://localhost:10000';\n  gameSocketInstance = new GameWebSocket(wsUrl, handlers);\n  gameSocketInstance.connect().then(() => {\n    // Authenticate with server\n    gameSocketInstance.send({\n      type: 'authenticate',\n      initData: userData.initData,\n      deviceInfo: {\n        platform: navigator.platform,\n        userAgent: navigator.userAgent,\n        screen: {\n          width: window.screen.width,\n          height: window.screen.height\n        }\n      }\n    });\n  });\n  return gameSocketInstance;\n};\nexport const sendMessage = data => {\n  if (!gameSocketInstance || !gameSocketInstance.isConnected) {\n    throw new Error('Socket not connected');\n  }\n  return gameSocketInstance.send(data);\n};\nexport const subscribeToMessages = callback => {\n  if (!gameSocketInstance) return () => {};\n  const originalHandler = gameSocketInstance.handlers.onMessage;\n  gameSocketInstance.handlers.onMessage = data => {\n    if (originalHandler) {\n      originalHandler(data);\n    }\n    callback(data);\n  };\n  return () => {\n    gameSocketInstance.handlers.onMessage = originalHandler;\n  };\n};","map":{"version":3,"names":["GameWebSocket","constructor","url","handlers","socket","reconnectAttempts","maxReconnectAttempts","reconnectDelay","messageQueue","isConnected","connect","Promise","resolve","reject","WebSocket","onopen","console","log","flushMessageQueue","onOpen","onmessage","event","data","JSON","parse","handleMessage","error","onclose","code","reason","onClose","attemptReconnect","onerror","onError","type","localStorage","setItem","sessionId","onMessage","send","push","jsonData","stringify","length","message","shift","setTimeout","catch","close","gameSocketInstance","connectToGameServer","userData","wsUrl","process","env","REACT_APP_WS_URL","then","initData","deviceInfo","platform","navigator","userAgent","screen","width","window","height","sendMessage","Error","subscribeToMessages","callback","originalHandler"],"sources":["/Users/habibullo/Desktop/like-duel/frontend/src/utils/gameWebSocket.js"],"sourcesContent":["// src/utils/gameWebSocket.js\nexport class GameWebSocket {\n    constructor(url, handlers) {\n      this.url = url;\n      this.handlers = handlers;\n      this.socket = null;\n      this.reconnectAttempts = 0;\n      this.maxReconnectAttempts = 5;\n      this.reconnectDelay = 3000;\n      this.messageQueue = [];\n      this.isConnected = false;\n    }\n  \n    connect() {\n      return new Promise((resolve, reject) => {\n        try {\n          this.socket = new WebSocket(this.url);\n  \n          this.socket.onopen = () => {\n            console.log('WebSocket connected');\n            this.isConnected = true;\n            this.reconnectAttempts = 0;\n            this.flushMessageQueue();\n            \n            if (this.handlers.onOpen) {\n              this.handlers.onOpen();\n            }\n            resolve();\n          };\n  \n          this.socket.onmessage = (event) => {\n            try {\n              const data = JSON.parse(event.data);\n              this.handleMessage(data);\n            } catch (error) {\n              console.error('Message parse error:', error);\n            }\n          };\n  \n          this.socket.onclose = (event) => {\n            console.log('WebSocket disconnected:', event.code, event.reason);\n            this.isConnected = false;\n            \n            if (this.handlers.onClose) {\n              this.handlers.onClose(event);\n            }\n            \n            this.attemptReconnect();\n          };\n  \n          this.socket.onerror = (error) => {\n            console.error('WebSocket error:', error);\n            this.isConnected = false;\n            \n            if (this.handlers.onError) {\n              this.handlers.onError(error);\n            }\n          };\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n  \n    handleMessage(data) {\n      console.log('Received:', data);\n      \n      // Global message handlers\n      switch (data.type) {\n        case 'authenticated':\n          localStorage.setItem('sessionId', data.sessionId);\n          break;\n        case 'error':\n          console.error('Server error:', data);\n          break;\n      }\n      \n      // Custom handler\n      if (this.handlers.onMessage) {\n        this.handlers.onMessage(data);\n      }\n    }\n  \n    send(data) {\n      if (!this.isConnected || !this.socket) {\n        this.messageQueue.push(data);\n        return false;\n      }\n  \n      try {\n        const jsonData = JSON.stringify(data);\n        this.socket.send(jsonData);\n        return true;\n      } catch (error) {\n        console.error('Send error:', error);\n        this.messageQueue.push(data);\n        return false;\n      }\n    }\n  \n    flushMessageQueue() {\n      while (this.messageQueue.length > 0) {\n        const message = this.messageQueue.shift();\n        this.send(message);\n      }\n    }\n  \n    attemptReconnect() {\n      if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n        console.error('Max reconnection attempts reached');\n        return;\n      }\n  \n      this.reconnectAttempts++;\n      console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\n  \n      setTimeout(() => {\n        this.connect().catch(error => {\n          console.error('Reconnect failed:', error);\n        });\n      }, this.reconnectDelay * this.reconnectAttempts);\n    }\n  \n    close() {\n      if (this.socket) {\n        this.socket.close();\n        this.socket = null;\n      }\n      this.isConnected = false;\n    }\n  }\n  \n  // Singleton instance\n  let gameSocketInstance = null;\n  \n  export const connectToGameServer = (userData, handlers) => {\n    if (gameSocketInstance) {\n      gameSocketInstance.close();\n    }\n  \n    const wsUrl = process.env.REACT_APP_WS_URL || 'ws://localhost:10000';\n    gameSocketInstance = new GameWebSocket(wsUrl, handlers);\n  \n    gameSocketInstance.connect().then(() => {\n      // Authenticate with server\n      gameSocketInstance.send({\n        type: 'authenticate',\n        initData: userData.initData,\n        deviceInfo: {\n          platform: navigator.platform,\n          userAgent: navigator.userAgent,\n          screen: {\n            width: window.screen.width,\n            height: window.screen.height\n          }\n        }\n      });\n    });\n  \n    return gameSocketInstance;\n  };\n  \n  export const sendMessage = (data) => {\n    if (!gameSocketInstance || !gameSocketInstance.isConnected) {\n      throw new Error('Socket not connected');\n    }\n    return gameSocketInstance.send(data);\n  };\n  \n  export const subscribeToMessages = (callback) => {\n    if (!gameSocketInstance) return () => {};\n    \n    const originalHandler = gameSocketInstance.handlers.onMessage;\n    \n    gameSocketInstance.handlers.onMessage = (data) => {\n      if (originalHandler) {\n        originalHandler(data);\n      }\n      callback(data);\n    };\n    \n    return () => {\n      gameSocketInstance.handlers.onMessage = originalHandler;\n    };\n  };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}